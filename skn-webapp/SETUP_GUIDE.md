# ğŸš€ SKN Project Setup Guide

## ğŸ“‹ **Prerequisites**

Before you begin, make sure you have:
- âœ… Node.js 18+ installed
- âœ… npm or yarn package manager
- âœ… Git installed
- âœ… Appwrite account (free at [appwrite.io](https://appwrite.io))

---

## ğŸ”§ **Step 1: Environment Configuration**

### **1.1 Copy Environment File**
```bash
cp .env.example .env.local
```

### **1.2 Configure Appwrite Variables**

#### **Required Variables (Must Fill):**
```env
# Your Appwrite Project ID (get from Appwrite Console)
NEXT_PUBLIC_APPWRITE_PROJECT_ID=your_actual_project_id_here

# Your Appwrite Database ID (create in Appwrite Console)
NEXT_PUBLIC_APPWRITE_DATABASE_ID=skn_database

# NextAuth Secret (generate a random string)
NEXTAUTH_SECRET=your_long_random_secret_key_here
```

#### **Optional Variables (Customize as needed):**
```env
# Business Logic (PKR amounts)
NEXT_PUBLIC_REGISTRATION_FEE=850
NEXT_PUBLIC_FIRST_PAIR_EARNING=400
NEXT_PUBLIC_REGULAR_PAIR_EARNING=200

# Payment Methods
NEXT_PUBLIC_BANK_NAME=Your Actual Bank Name
NEXT_PUBLIC_BANK_ACCOUNT_NUMBER=Your Actual Account Number
NEXT_PUBLIC_EASYPAISA_NUMBER=Your Actual EasyPaisa Number
NEXT_PUBLIC_JAZZCASH_NUMBER=Your Actual Jazz Cash Number

# Company Information
NEXT_PUBLIC_CONTACT_EMAIL=your_actual_email@domain.com
NEXT_PUBLIC_CONTACT_PHONE=your_actual_phone_number
```

---

## ğŸ†” **Appwrite Document Structure**

### **Automatic Fields (You Don't Need to Create):**

| Field | Type | Description |
|-------|------|-------------|
| **`$id`** | string | **Unique document ID** - Auto-generated by Appwrite |
| **`$createdAt`** | string | **Creation timestamp** - Auto-generated by Appwrite |
| **`$updatedAt`** | string | **Last update timestamp** - Auto-generated by Appwrite |
| **`$permissions`** | array | **Access permissions** - Managed by Appwrite |

### **Custom Fields (You Need to Create):**
All other fields in your collections are custom and must be created manually.

### **Important Notes:**
- âœ… **`$id` is automatically unique** - No duplicates possible
- âœ… **`$id` is 36 characters long** - UUID format
- âœ… **You can reference `$id` in other collections** - For relationships
- âœ… **Never modify `$id`** - It's read-only

---

## ğŸ—„ï¸ **Step 2: Appwrite Setup**

### **2.1 Create Appwrite Project**
1. Go to [Appwrite Console](https://console.appwrite.io)
2. Click "Create Project"
3. Name: `SKN Network Marketing`
4. Copy the **Project ID** to `.env.local`

### **2.2 Create Database**
1. In your project, go to **Databases**
2. Click **Create Database**
3. Name: `skn_database`
4. Database ID: `skn_database`
5. Copy the **Database ID** to `.env.local`

### **2.3 Create Collections**

#### **Collection: `users`**
```
Name: users
Collection ID: users
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default | Description |
|------|------|----------|------|---------|-------------|
| $id | string | âœ… | 36 | auto | **Auto-generated by Appwrite** |
| email | string | âœ… | 255 | - | User's email (same as Appwrite auth) |
| name | string | âœ… | 100 | - | User's display name |
| phone | string | âŒ | 20 | - | Optional phone number |
| profileImage | string | âŒ | 255 | - | Profile picture URL |
| referralCode | string | âœ… | 8 | - | Unique 8-character referral code |
| referredBy | string | âŒ | 8 | - | Referral code of sponsor |
| position | string | âŒ | 10 | - | 'left' or 'right' in sponsor's tree |
| sponsorId | string | âŒ | 36 | - | ID of referring user |
| leftUserId | string | âŒ | 36 | - | ID of left child user |
| rightUserId | string | âŒ | 36 | - | ID of right child user |
| leftPairs | integer | âœ… | - | 0 | Completed pairs on left side |
| rightPairs | integer | âœ… | - | 0 | Completed pairs on right side |
| totalEarnings | integer | âœ… | - | 0 | Total earnings in PKR |
| starLevel | integer | âœ… | - | 0 | Current star level (0-12) |
| isActive | boolean | âœ… | - | true | Account active status |
| isVerified | boolean | âœ… | - | false | Payment verified status |
| registrationFee | integer | âœ… | - | 850 | Registration fee paid |
| paymentStatus | string | âœ… | - | pending | 'pending', 'processing', 'completed', 'failed' |
| lastLoginAt | string | âŒ | - | - | Last login timestamp |
| createdAt | string | âœ… | - | - | Account creation time |
| updatedAt | string | âœ… | - | - | Last update time |

**âš ï¸ IMPORTANT: Password is NOT stored here!**
- Passwords are handled by Appwrite's built-in Authentication Service
- When user registers, Appwrite creates auth account with email/password
- Your `users` collection stores additional business data linked by email

#### **Collection: `referrals`**
```
Name: referrals
Collection ID: referrals
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| sponsorId | string | âœ… | 36 | - |
| referralCode | string | âœ… | 8 | - |
| position | string | âœ… | 10 | - |
| level | integer | âœ… | - | 0 |
| isActive | boolean | âœ… | - | true |
| isProcessed | boolean | âœ… | - | false |
| referredAt | string | âœ… | - | - |
| processedAt | string | âŒ | - | - |

#### **Collection: `transactions`**
```
Name: transactions
Collection ID: transactions
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| type | string | âœ… | 50 | - |
| amount | integer | âœ… | - | 0 |
| description | string | âœ… | 255 | - |
| status | string | âœ… | 20 | pending |
| reference | string | âŒ | 36 | - |
| pairId | string | âŒ | 36 | - |
| leftUserId | string | âŒ | 36 | - |
| rightUserId | string | âŒ | 36 | - |
| starLevel | integer | âŒ | - | - |
| processedAt | string | âŒ | - | - |
| createdAt | string | âœ… | - | - |

#### **Collection: `pair_completions`**
```
Name: pair_completions
Collection ID: pair_completions
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| leftUserId | string | âœ… | 36 | - |
| rightUserId | string | âœ… | 36 | - |
| pairNumber | integer | âœ… | - | - |
| earnings | integer | âœ… | - | 0 |
| isProcessed | boolean | âœ… | - | false |
| isStarLevel | boolean | âœ… | - | false |
| completedAt | string | âœ… | - | - |
| processedAt | string | âŒ | - | - |

#### **Collection: `star_achievements`**
```
Name: star_achievements
Collection ID: star_achievements
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| level | integer | âœ… | - | - |
| reward | integer | âœ… | - | 0 |
| leftPairs | integer | âœ… | - | - |
| rightPairs | integer | âœ… | - | - |
| isProcessed | boolean | âœ… | - | false |
| achievedAt | string | âœ… | - | - |
| processedAt | string | âŒ | - | - |

#### **Collection: `payments`**
```
Name: payments
Collection ID: payments
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| amount | integer | âœ… | - | - |
| type | string | âœ… | 20 | - |
| paymentMethod | string | âœ… | 20 | - |
| transactionId | string | âŒ | 100 | - |
| status | string | âœ… | 20 | pending |
| proofImage | string | âŒ | 255 | - |
| notes | string | âŒ | 500 | - |
| verifiedBy | string | âŒ | 36 | - |
| verifiedAt | string | âŒ | - | - |
| createdAt | string | âœ… | - | - |

#### **Collection: `user_sessions`**
```
Name: user_sessions
Collection ID: user_sessions
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| sessionId | string | âœ… | 255 | - |
| lastActivity | string | âœ… | - | - |
| isActive | boolean | âœ… | - | true |
| userAgent | string | âŒ | 500 | - |
| ipAddress | string | âŒ | 45 | - |

#### **Collection: `network_stats`**
```
Name: network_stats
Collection ID: network_stats
Permissions: Read/Write for authenticated users
```

**Attributes:**
| Name | Type | Required | Size | Default |
|------|------|----------|------|---------|
| userId | string | âœ… | 36 | - |
| totalReferrals | integer | âœ… | - | 0 |
| leftReferrals | integer | âœ… | - | 0 |
| rightReferrals | integer | âœ… | - | 0 |
| totalPairs | integer | âœ… | - | 0 |
| leftPairs | integer | âœ… | - | 0 |
| rightPairs | integer | âœ… | - | 0 |
| totalEarnings | integer | âœ… | - | 0 |
| pairEarnings | integer | âœ… | - | 0 |
| starEarnings | integer | âœ… | - | 0 |
| currentStarLevel | integer | âœ… | - | 0 |
| nextStarLevel | integer | âœ… | - | 1 |
| nextStarProgress | integer | âœ… | - | 0 |
| lastCalculated | string | âœ… | - | - |

### **2.4 Create Storage Buckets**

#### **Bucket: `profile_images`**
```
Name: profile_images
Bucket ID: profile_images
Permissions: Read for all, Write for authenticated users
File Size Limit: 5 MB
Allowed Extensions: jpg, jpeg, png, gif
```

#### **Bucket: `payment_proofs`**
```
Name: payment_proofs
Bucket ID: payment_proofs
Permissions: Read for authenticated users, Write for authenticated users
File Size Limit: 10 MB
Allowed Extensions: jpg, jpeg, png, pdf
```

### **2.5 Create Indexes**

#### **For `users` collection:**
```
email (string, unique)
referralCode (string, unique)
sponsorId (string)
isActive (boolean)
isVerified (boolean)
paymentStatus (string)
createdAt (string)
```

#### **For `referrals` collection:**
```
userId (string)
sponsorId (string)
position (string)
isActive (boolean)
referredAt (string)
```

#### **For `transactions` collection:**
```
userId (string)
type (string)
status (string)
createdAt (string)
```

#### **For `pair_completions` collection:**
```
userId (string)
isProcessed (boolean)
completedAt (string)
```

#### **For `star_achievements` collection:**
```
userId (string)
level (integer)
isProcessed (boolean)
achievedAt (string)
```

#### **For `payments` collection:**
```
userId (string)
status (string)
type (string)
createdAt (string)
```

---

## ğŸ’³ **Automatic Payment Verification Flow**

### **How Payment Verification Works:**

#### **Step 1: User Registration**
```
User fills registration form â†’ System creates account
â†“
Payment status: 'pending'
â†“
User cannot access referral system yet
```

#### **Step 2: Payment Processing**
```
User pays 850 PKR via payment gateway
â†“
Payment status: 'processing'
â†“
System waits for payment confirmation
```

#### **Step 3: Payment Confirmation**
```
Payment gateway confirms successful payment
â†“
System automatically updates:
- paymentStatus: 'completed'
- isVerified: true
- isActive: true
â†“
User can now access referral system
```

#### **Step 4: Failed Payment**
```
If payment fails or times out
â†“
Payment status: 'failed'
â†“
User must retry payment to continue
```

### **Payment Status Values:**
- **`pending`** - User registered, payment not initiated
- **`processing`** - Payment initiated, waiting for confirmation
- **`completed`** - Payment successful, user verified
- **`failed`** - Payment failed or timed out

### **Integration Points:**
- **EasyPaisa API** - Automatic confirmation
- **Jazz Cash API** - Automatic confirmation  
- **Bank Transfer** - Manual upload + admin verification
- **Other Gateways** - Based on their webhook system

---

## ğŸ” **How Authentication Works in Appwrite**

### **Step 1: User Registration**
```typescript
// 1. Create Appwrite Auth Account (handles password)
const user = await account.create(
  ID.unique(),
  email,
  password,
  name
);

// 2. Create Custom User Document in your collection
const userDoc = await databases.createDocument(
  DATABASE_ID,
  COLLECTIONS.USERS,
  ID.unique(),
  {
    email: email,
    name: name,
    referralCode: generateReferralCode(),
    // ... other business data
  }
);
```

### **Step 2: User Login**
```typescript
// Appwrite handles password verification automatically
const session = await account.createSession(email, password);

// Get user data from your collection
const userDoc = await databases.listDocuments(
  DATABASE_ID,
  COLLECTIONS.USERS,
  [Query.equal('email', email)]
);
```

### **Step 3: Password Management**
```typescript
// Change password (Appwrite handles this)
await account.updatePassword(password, newPassword);

// Reset password (Appwrite handles this)
await account.createRecovery(email, redirectUrl);
```

---

## ğŸš€ **Step 3: Install Dependencies**

```bash
npm install
```

---

## ğŸ”‘ **Step 4: Generate Secrets**

### **4.1 Generate NextAuth Secret**
```bash
# Option 1: Using OpenSSL
openssl rand -base64 32

# Option 2: Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Option 3: Online generator
# Visit: https://generate-secret.vercel.app/32
```

### **4.2 Update .env.local**
```env
NEXTAUTH_SECRET=your_generated_secret_here
```

---

## ğŸ§ª **Step 5: Test Setup**

### **5.1 Build Project**
```bash
npm run build
```

### **5.2 Start Development Server**
```bash
npm run dev
```

### **5.3 Test Appwrite Connection**
1. Open browser to `http://localhost:3000`
2. Try to register a new user
3. Check Appwrite Console for new user creation

---

## âš ï¸ **Common Issues & Solutions**

### **Issue 1: "Project ID not found"**
- âœ… Check `NEXT_PUBLIC_APPWRITE_PROJECT_ID` in `.env.local`
- âœ… Verify project exists in Appwrite Console
- âœ… Ensure project is active

### **Issue 2: "Database not found"**
- âœ… Check `NEXT_PUBLIC_APPWRITE_DATABASE_ID` in `.env.local`
- âœ… Verify database exists in Appwrite Console
- âœ… Ensure database is active

### **Issue 3: "Collection not found"**
- âœ… Check collection IDs in `.env.local`
- âœ… Verify collections exist in Appwrite Console
- âœ… Ensure collections have correct permissions

### **Issue 4: "Permission denied"**
- âœ… Check collection permissions in Appwrite Console
- âœ… Ensure collections allow authenticated users to read/write
- âœ… Verify user is properly authenticated

---

## ğŸ”’ **Security Checklist**

- âœ… Environment variables are in `.env.local` (not committed to git)
- âœ… Appwrite project has proper security rules
- âœ… Collections have appropriate permissions
- âœ… File uploads have size and type restrictions
- âœ… Authentication is properly implemented
- âœ… API endpoints are protected

---

## ğŸ“± **Next Steps**

After successful setup:
1. ğŸ¨ **Customize UI** - Update colors, logos, branding
2. ğŸ”§ **Configure Business Logic** - Adjust earning rates, star levels
3. ğŸ’³ **Set Up Payment Methods** - Add real bank details, mobile money
4. ğŸ“§ **Email Configuration** - Set up SMTP for notifications
5. ğŸš€ **Deploy** - Deploy to Vercel, Netlify, or your preferred platform

---

## ğŸ“ **Need Help?**

- ğŸ“§ Email: support@skn.com
- ğŸ“± WhatsApp: +92-300-1234567
- ğŸ“– Documentation: Check project README.md
- ğŸ› Issues: Create GitHub issue

---

**Happy Coding! ğŸ‰** 